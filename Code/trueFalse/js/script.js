const STORE = {
    questions: {   
     "General": [
      {
       question: "Including your name and/or birthday in your password makes it easy to bypass",
       code: ``,
       answers: [
        "False",
        "True"
       ],
       correctAnswer: "True"
      },{
       question: "Adding symbols such as a number and symbol such as an exclamation point creates a stronger password",
       code: '~ ` ! @ # $ % ^ & * ( ) _ - + = : ;{ [ } ] | " < , > . ? /',
       answers: [
        "False",
        "True"
       ],
       correctAnswer: "True"
      },{
       question: "Public WIFI networks are always safe to use otherwise they will not be available to the public",
       code: ``,
       answers: [
        "False",
        "True"
       ],
       correctAnswer: "False"
      },{
       question: "Having a firewall prevents cyber criminals from targeting you",
       code: ``,
       answers: [
        "False",
        "True"
       ],
       correctAnswer: "False"
      },{
       question: "It is possible for cyber criminals to install malware to your device once you are connected to a malicious network without your knowledge",
       code: ``,
       answers: [
        "False",
        "True"
       ],
       correctAnswer: "True"
      }
     ],
     "Phishing emails": [
        {
         question: "You receive an email from the finance department at the company you work for asking you to confirm your banking details in order to get paid. As it was sent to your work email and not your personal email, you do not need to check if itâ€™s legitimate",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "False"
        },{
         question: "You receive an email from an unknown address with a deceptive domain",
         code: ``,
         answers: [
          "Fraudulent",
          "Legitimate"
         ],
         correctAnswer: "Fraudulent"
        },{
         question: "You can identify a phishing email through grammatical errors",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Being sent an unsolicited invoice can mean that it is a phishing email",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "An email requesting information is trustworthy as long as they claim who they are",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "False"
        }
       ],
       "General knowledge": [
        {
         question: "As it stands, phishing attacks are on the rise and is expected to double by 2025",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Spear phihsing emails are the most popular target attack vector",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Sophistication of phishing attacks are increasing",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Financial services such as banks, Paypal, and Monzo are the biggest targets",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Almost 50% of malicious email attachments are Office files ",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        }
       ],
       "Mitigation techniques": [
        {
         question: "Learning psychological triggers can help mitigate against phishing",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Filtering emails can help with the amount of phishing emails one may receive",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Avoiding using public networks can help reduce the chances of being targetted",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Unrelated pop-ups are never harmless",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "False"
        },{
         question: "Companies that do not enforce learning about phishing are as safe as companies that do",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "False"
        }
       ],
       "Identification": [
        {
         question: "Emails demanding urgent action is a sign of a phishing email",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Bad grammar and spelling mistakes tend to happen and therefore is not a sign of a phishing email",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "False"
        },{
         question: "Unfamiliar file extensions such as a .zip and .exe can be a sign of a phishing email",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        }
       ],
       "Definition of Phishing": [
        {
         question: "Phishing is a type of social engineering method used by cyber criminals to steal information from unsuspecting victims through deception",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Phishing is a type of social engineering method used by criminals to steal information from people through sending mail cards",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "False"
        },{
         question: "Phishing is a type of social engineering method where a scammer lures a victim using false promises to then steal information",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "False"
        },{
         question: "Phishing is a type of social engineering method where an unauthorised person enters a building by following someone with legitimate access to that building",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "False"
        },
       ],
       "Types of social engineering methods": [
        {
         question: "Baiting is a type of social engineering",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Tailgating is a type of social engineering attack",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Quid Pro Quo is a type of social engineering",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "In honey trap, the perpetrator pretends to be romantically interested in the victim to get them to reveal confidential information or gain financially from them",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Skyware is a form of social engineering",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "False"
        }
       ],
       "Phishing types": [
        {
         question: "There are at least a dozen types of phishing types",
         code: ``,
         answers: [
          "True",
          "False"
         ],
         correctAnswer: "True"
        },{
         question: "Angler phishing is a type of phishing",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Angling phishing is a type of phishing",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "False"
        },{
         question: "Smishing and Vishing differs from email phishing through the communication methods used",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Sharking is a sophisticated version of Whaling",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "False"
        }
       ],
       "Smishing and Vishing": [
        {
         question: "Smishing is where a malicious text message is sent",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Smishing and regular email phishing differ through communication method",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Scammers may use high profile banks such as Barclays and HSBC to deceive victims",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "A message claiming to be from your bank asks you for your PIN number",
         code: ``,
         answers: [
          "Fraudulent",
          "Legitimate"
         ],
         correctAnswer: "Fraudulent"
        },{
         question: "You get an unexpected phone call from your bank regarding your account",
         code: ``,
         answers: [
          "Fraudulent",
          "Legitimate"
         ],
         correctAnswer: "Fraudulent"
        }
       ],
       "Spear phishing": [
        {
         question: "Spear phishing are personalised attacks",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Spear phishing are sent in masses",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "False"
        },{
         question: "Spear phishing can happen through any communication methods such as emails, texts, and online messages",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Spear phishing attackers tend to do research on their victims beforehand",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        },{
         question: "Information about the victim that is not public may be included in a spear phishing attack",
         code: ``,
         answers: [
          "False",
          "True"
         ],
         correctAnswer: "True"
        }
       ]
      }
     };
   
   
   // Creates the quiz. Create a model for the app's state
   function makeQuiz(){
       // Creating an object to store the app's state when beginning the quiz
       return {
           // Gathering a random question out of the available questions for each category
           questions: helpers.getRandomQuestions(STORE),
           // Boolean for if the quiz is in progress or not
           midQuiz: false,
           // Array of correct/incorrect answers to use for the  progress bar
           progress: {
               progressBar: [],
               incorrectCategories: []
           },
           // Boolean to determine if the end state should display or not
           completed: false,
           // Monitoring which question we are currently on
           currentQuestion: 0,
           // Keeps track of total correct answers
           correctAnswers: 0,
           // Keeps current selected answer
           currentAnswer: "",
           // Keeps track of % completed
           percCorrect: 0
       }
   }
   
   // Applies fadeOut animation and sets the "stage" for DOM text and/or element changes
   function $fade(appState){
   
       // Completed state of the app
       if(appState.completed){
           
           // Fixed fade out behaviour (not choppy)
           $.when($('.question-answer-wrapper, .question-wrapper, .answer-wrapper').fadeOut(500))
               .done(function(){
   
                   // Display results of the quiz to user
                   $showResults(appState);
                   $('.results-wrapper').hide().removeClass('hide');
                   $('.question-answer-wrapper, .results-wrapper').fadeIn(500);
           });
   
       // Initial start of app
       } else if(appState.midQuiz === false){
   
           // Set a flag that the app has begun
           appState.midQuiz = true;
           // Fixed fade out behaviour (not choppy)
           $.when($('.question-answer-wrapper, .question-wrapper, .code, .answer-wrapper, .start-quiz, .quit-quiz, .results-wrapper, .progress, .progress-bar').fadeOut(500))
               .done(function(){
                   // Removes progress from last execution
                   helpers.updateProgressBar(appState);
                   $('.progress-count').html('1 / 10');
                   $('.progress-perc').html('');
                   // Removes previous result
                   $('.failures').remove();
                   // New environment for the quiz
                   $updateQuestion(appState);
                   $('progress-bar').empty();
                   $('progress-fill').html('Progress: <span class="progress-count">1 / 10</span><span class="progress-perc"></span>');
                   $('.question-answer-wrapper, .answer-wrapper').removeClass('begin');
                   $('.submit-btn, .progress, .progress-bar').removeClass('hide');
                   $('.progress, .progress-bar').hide();
                   $('.question-answer-wrapper, .question-wrapper, .answer-wrapper, .progress, .progress-bar').fadeIn(500);
                   if(!$('.code').hasClass('hide')){$('.code').fadeIn(500)};
           });
   
       // App in the middle of execution
       } else if(appState.midQuiz){
           $.when($('.question-answer-wrapper, .question-wrapper, .answer-wrapper').fadeOut(500))
               .done(function(){
                   $updateQuestion(appState);
                   $('.question-answer-wrapper, .question-wrapper, .answer-wrapper').fadeIn(500);
           });
       }
   }
   
   // Results with feedback depending on score
   function $showResults(appState){
       if(appState.correctAnswers === 100){
           let endMsg = `You got ${appState.percCorrect}% of the questions correct!
           You aced the quiz but that doesn't mean there's nothing else to learn. Head over to the 'Extra' tab to see what else you can learn!`;
       } else {
           $('.answer-btn').remove();
           let endMsg = `You got ${appState.percCorrect}% correct!`
           let endFeedback = ``;
           if(appState.progress.incorrectCategories.length === 0){
               endFeedback = `You got every question right! Well done!`;
           } else {
               endFeedback = `You may want to study up on the following categories:`;
           }

           $('.quiz-end-score').html(endMsg);
           let $failList = $('<ul class="failures"></ul>');
           appState.progress.incorrectCategories.map((cat => {
               $failList.append("<li class='category'>" + cat + "</li>");
           }));
           $('.quiz-end-feedback-p').html(endFeedback);
           $('.quiz-end-categories').append($failList);
           $('.results-wrapper').removeClass('hide').css('display', 'flex');
           $('.question-answer-wrapper, .results-wrapper, .quiz-end-feedback, .quiz-end-score, .retry-btn').css('display', 'flex').fadeIn(500);		
       }
   
   }
   
   // Update the question, code, answers, buttons in the DOM while we're in a faded out state
   function $updateQuestion(appState){
       $('.answer-btn').remove();
   
       // Update the question and code text with the current question
       $('.question').html(appState.questions[appState.currentQuestion].question);
   

       if(appState.questions[appState.currentQuestion].code == ``){
           $('.code').addClass('hide');
       } else {
           $('.code').removeClass('hide');
           $('.code').html(`<pre>${appState.questions[appState.currentQuestion].code}</pre>`);
       }
       
       // Change continue back to submit
       $('.continue-btn')
           .val("Submit")
           .removeClass('continue-btn')
           .addClass('submit-btn')
           .prop('disabled', true);
   
       // Add in available answers for the question
       let $answers = [];
   
       // Adding the answers to a temporary array
       for(let i=0; i<appState.questions[appState.currentQuestion].answers.length; i++){
   
           // Add current question answers to an array
           let $answer = $('<button class="answer-btn" type="button"></button>');
           $answer.html(appState.questions[appState.currentQuestion].answers[i]);
           $answers.push($answer);
       }
   
       /* Shuffles the answers so that each execuation will show them in a different order - Disabled for T or F
       helpers.shuffleAnswers($answers) */
   
       // Push answers to the DOM
       $answers.forEach((answer) => {
           $('.answer-wrapper').prepend(answer);
       });
   }
   
   // Simple class and enable/disable of DOM selection when answer is selected
   function selectAnswer(answer){
       $('.answer-btn').removeClass('selected');
       answer.addClass('selected');
       $('.submit-btn').prop('disabled', false);
   }
   
   // Answer is selected and submitted
   // Push a feedback state
   function submitAnswer(appState){
   
       // This will return true or false based on their answer
       let correct;
   
       // Adds styles to the answers to show if their answer was correct or not
       $('.answer-btn').each(function () {
           if($(this).html() === appState.questions[appState.currentQuestion].correctAnswer){
               $(this).addClass('pass');
               // If the answer given is correct and selected
               if($(this).hasClass('selected')){
                   correct = "pass";
                   appState.correctAnswers++;
                   appState.questions[appState.currentQuestion];
               }
   
           // Handle correct answer if selected answer is incorrect
           } else if ($(this).hasClass('selected')){
               $(this).addClass('fail dim-answer');
               correct = "fail";
               appState.progress.incorrectCategories.push(appState.questions[appState.currentQuestion].category);
   
           // Dim the other answers to make the correct one more prevalent
           } else {
               $(this).addClass('dim-answer');
           }
       });
   
       // Add a progress bar indicator 
       appState.progress.progressBar.push(`<div class="progress-indicator ${correct}"></div>`);
       
       // Update % correct 
       appState.percCorrect = parseFloat(appState.correctAnswers / (appState.currentQuestion + 1) * 100).toFixed();
   
       // Update current question against total quiz length
       $('.progress-count').html(`
           ${appState.currentQuestion + 1} / ${appState.questions.length}
       `);
   
       // Updates current % of correct answer
       $('.progress-perc').html(`
            // ${(appState.percCorrect)}% Correct
       `)
   
       // Change submit to continue after answering
       $('.submit-btn')
           .val("Continue")
           .removeClass('submit-btn')
           .addClass('continue-btn')
   
       // Disable selecting anopther answer
       $('.answer-btn').prop("disabled", true);
   
       // Update progress bar DOM
       helpers.updateProgressBar(appState);
   
       // Continue to next question
       appState.currentQuestion++;
   
       // Verify if we're done or not
       if(appState.currentQuestion === appState.questions.length){
           appState.completed = true;
       }
       
   }
   
   // Simple algorithms to modify data that doesn't use individual functions
   let helpers = {
       // Pick a random question from the available ones
       pickRandomQ: function(obj,section){
           return Math.floor(Math.random() * obj.questions[section].length);		
       },
       // Pick a random question from every category
       getRandomQuestions: function(obj){
           let questions = [];
           let categories = Object.keys(obj.questions);
           categories.forEach((cat) => {
               let randomQ = this.pickRandomQ(obj,cat);
               let question = obj.questions[cat][randomQ];
               question.category = cat;
               questions.push(question);
           });
           return questions;
       },
       /* Shuffle the answers so they don't appear in the same order - Disabled for T or F
       shuffleAnswers: function(arr){
           for (var i = arr.length - 1; i > 0; i--) {
               var j = Math.floor(Math.random() * (i + 1));
               var temp = arr[i];
               arr[i] = arr[j];
               arr[j] = temp;
           }
       }, */
       // Update progress bar DOM element
       updateProgressBar: function(appState){
           $('.progress-bar').empty();
           appState.progress.progressBar.forEach((progInd => {
               $('.progress-bar').append(progInd);
           }))
       }
   }
   
   // Start
   $(function(){
   
       // Prevents refresh 
       $('.answer-wrapper').on('submit', function(e){
           e.preventDefault();
       });
   
       // Temporary storage for when app is running
       let quizData;
   
       // Start quiz
       $('.start-quiz, .retry-btn').on('click', function(){
           quizData = makeQuiz();
           $fade(quizData);
       });
   
       // Select an answer
       $('.question-answer-wrapper').on('click', '.answer-btn', function(){
           selectAnswer($(this));
       })
   
       // Submit answer to display whether answer is right or wrong and advance q counter
       $('.question-answer-wrapper').on('click', '.submit-btn', function(e){
           submitAnswer(quizData);
       });
   
       // Submit your answer to display feedback and advance question counter
       $('.question-answer-wrapper').on('click', '.continue-btn', function(){
           $fade(quizData);
       });
   
   })
   